<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.8"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>Leosac: Authentication Documentation</title>
        <!--<link href="../../tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="../../dynsections.js"></script>
        <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
        <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
        <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">Leosac </a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Authentication Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#auth_intro">Introduction </a><ul><li class="level2"><a href="#auth_data_type">Authentication data type </a></li>
</ul>
</li>
<li class="level1"><a href="#auth_specc">Message Passing Specifications </a></li>
</ul>
</div>
<div class="textblock"><p>Explain how the authentication and authorization subsystem works.</p>
<h1><a class="anchor" id="auth_intro"></a>
Introduction </h1>
<p>In an access control system, the authentication &amp; authorization subsystem is complex. This page aims to explain how it works in Leosac.</p>
<p>The task of reading credentials, validating them and taking action (opening doors) is split over multiple module. This gives us more flexibility and helps keeping the code clear and relatively simple.</p>
<p>Below is a diagram that illustrate how thing works: </p><div class="image">
<img src="../../../resources/overview_auth.png"  alt="Auth overview diagram"/>
</div>
 <h1>Two kinds of modules </h1>
<p>We break down the authentication &amp; authorization code in multiple parts. There are two kinds of modules:</p><ol type="1">
<li>Authentication Source module (eg <a class="el" href="../../d6/dad/mod_wiegand_main.html">Wiegand</a>)</li>
<li>Authentication Backend module (eg <a class="el" href="../../d0/d25/mod_auth_file_main.html">Files</a>)</li>
</ol>
<h2>Authentication Source </h2>
<p>An <b>authentication source</b> module provides user-data to the system, for example a card id or a pin code. Theses modules are first in the chain of event that lead to an access control.</p>
<p>An authentication <b>shall</b> have at least one property: a name. This name will be used throughout the application to determine what device (or authentication source) triggered the events.</p>
<p>TODO: Also we need something to identify the [type](ref auth_data_type) of the data. (pin vs pin/card id vs card id vs ...)</p>
<h2>Authentication Backend </h2>
<p>An <b>authentication backend</b> module gather event from <b>authentication source</b> and check their own backend to build a profile (raw files, database, remote webservices, ...)</p>
<p>The profile is built by checking group-membership, credentials mapping, etc. The newly built profile is then queried to determine whether or not the user should be granted access.</p>
<p>In order for this to work properly, we need a decent message passing specifications.</p>
<h2><a class="anchor" id="auth_data_type"></a>
Authentication data type </h2>
<p>Data type information helps authentication backends understand messages from authentication sources. It is an enumeration value, see <a class="el" href="../../d0/d31/namespaceLeosac_1_1Auth.html#acab42172927988f0c2c41e4170c6fc7c">AuthSourceType</a>.</p>
<p>Currently we are lucky, we only define a few.</p>
<ol type="1">
<li><b>SIMPLE_WIEGAND</b>: This data type requires 2 frames:<ol type="a">
<li>An hexadecimal <em>string</em> that contain the card id that was read, for example: "40:a0:83:80"</li>
<li>An <em>integer</em> that holds the number of bits in the card id.</li>
</ol>
</li>
<li><b>WIEGAND_PIN</b>: Configuration mode used when we use the reader only for PIN code.<ol type="a">
<li>A <em>string</em> that contains the PIN code. Its easier to use string, because we don't know the length of the PIN code, and it may vary.</li>
</ol>
</li>
<li><b>WIEGAND_CARD_PIN</b>: This credential mode holds both a wiegand card number along with a PIN code.<ol type="a">
<li>An hexadecimal <em>string</em> that contain the card id that was read, for example: "40:a0:83:80"</li>
<li>An <em>integer</em> that holds the number of bits in the card id.</li>
<li>A <em>string</em> that contains the PIN code.</li>
</ol>
</li>
</ol>
<h1><a class="anchor" id="auth_specc"></a>
Message Passing Specifications </h1>
<p>Understand the <a class="el" href="../../dd/dc8/classMessageBus.html">application message bus</a> first.</p>
<p>First, a few assumptions. Authentication data from auth source may vary widely. Consider a simple pin code versus a wiegand card id. The wiegand card must holds 2 data: the value, and the number of meaningful bits. A wiegand reader can also handle PIN code + card id, augmenting complexity of the auth data.</p>
<p>Auth backend must be able to distinguish between those to handles them properly.</p>
<h3>Authentication Source</h3>
<p>Workflow for an <b>authentication source</b> module:</p><ol type="1">
<li>Having enough meaningful data that represents an authentication source (card id, pin code, fingerprint, ...) the module shall publish a message on the message bus the let others know.</li>
<li>The message shall be multiparts.<ol type="a">
<li>Its first frame must be the auth source's name prefixed by <code>S_</code>.</li>
<li>The second frame shall be the type of data. See <a class="el" href="../../df/d33/auth_main.html#auth_data_type">this</a>.</li>
<li>Optional (but likely presents) frames that contains different data based on the <a class="el" href="../../df/d33/auth_main.html#auth_data_type">auth data type</a></li>
</ol>
</li>
</ol>
<p>As an example, consider a message from the <a class="el" href="../../d6/dad/mod_wiegand_main.html">wiegand module</a>, named <code>MY_WIEGAND_1</code>:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"MY_WIEGAND_1" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td><code>Leosac::Auth::SourceType::SIMPLE_WIEGAND</code> </td><td><a class="el" href="../../d0/d31/namespaceLeosac_1_1Auth.html#acab42172927988f0c2c41e4170c6fc7c">AuthSourceType</a> (<code>uint8_t</code>) </td></tr>
<tr>
<td>3 </td><td>"12:af:cd:21" </td><td><code>string</code> </td></tr>
<tr>
<td>4 </td><td>26 </td><td><code>int</code> </td></tr>
</table>
<p>A second example for the <code>WIEGAND_PIN</code> auth source mode:</p>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"MY_WIEGAND_1" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td><code>Leosac::Auth::SourceType::WIEGAND_PIN</code> </td><td><a class="el" href="../../d0/d31/namespaceLeosac_1_1Auth.html#acab42172927988f0c2c41e4170c6fc7c">AuthSourceType</a> (<code>uint8_t</code>) </td></tr>
<tr>
<td>3 </td><td>"1234591" </td><td><code>string</code> </td></tr>
</table>
<h3>Authentication Backend</h3>
<p>Workflow for an <b>authentication backend</b> module:</p><ol type="1">
<li>Receive a message from an <b>auth source</b>.</li>
<li>Process the message, and decide whether access shall be granted or not.</li>
<li>Send a multiparts response message.<ol type="a">
<li>The first frame MUST be <code>S_{AUTH_INSTANCE_NAME}</code>.</li>
<li>The second frame shall be an <a class="el" href="../../d0/d31/namespaceLeosac_1_1Auth.html#a01fd31044ca7215b621bc12f7cde91a3">AccessStatus</a>.</li>
</ol>
</li>
</ol>
<table class="doxtable">
<tr>
<th>Frame </th><th>Content </th><th>Type  </th></tr>
<tr>
<td>1 </td><td>"S_MY_AUTH_SOURCE_1" </td><td><code>string</code> </td></tr>
<tr>
<td>2 </td><td><code>Leosac::Auth::AccessStatus::Granted</code> </td><td><a class="el" href="../../d0/d31/namespaceLeosac_1_1Auth.html#a01fd31044ca7215b621bc12f7cde91a3">AccessStatus</a> (<code>uint8_t</code>) </td></tr>
</table>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 19 2015 14:16:50 for Leosac by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
